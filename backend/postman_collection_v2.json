{
	"info": {
		"_postman_id": "a8f5b4a1-1b3a-4b1e-8f0a-3e1d1e1e1e1e",
		"name": "Appointment Master API v2",
		"description": "A comprehensive collection for testing the Appointment Master API, including party appointments.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Authentication",
			"item": [
				{
					"name": "Create User 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const randomEmail1 = 'user1.' + Date.now() + '@example.com';",
									"pm.environment.set('email1', randomEmail1);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have user ID', () => { pm.expect(jsonData).to.have.property('id'); });",
									"pm.environment.set('userId1', jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Test User One\",\n    \"email\": \"{{email1}}\",\n    \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					}
				},
				{
					"name": "Create User 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const randomEmail2 = 'user2.' + Date.now() + '@example.com';",
									"pm.environment.set('email2', randomEmail2);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have user ID', () => { pm.expect(jsonData).to.have.property('id'); });",
									"pm.environment.set('userId2', jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Test User Two\",\n    \"email\": \"{{email2}}\",\n    \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					}
				},
				{
					"name": "Login User 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 OK', () => { pm.response.to.have.status(200); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have token', () => { pm.expect(jsonData).to.have.property('token'); });",
									"pm.environment.set('authToken1', jsonData.token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{email1}}\",\n    \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"login"
							]
						}
					}
				},
				{
					"name": "Login User 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 OK', () => { pm.response.to.have.status(200); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have token', () => { pm.expect(jsonData).to.have.property('token'); });",
									"pm.environment.set('authToken2', jsonData.token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{email2}}\",\n    \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"login"
							]
						}
					}
				}
			]
		},
		{
			"name": "2. Party Appointment Lifecycle",
			"item": [
				{
					"name": "Create Party Appointment",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Set dynamic date for the party (next week at the same time)",
									"const nextWeek = new Date();",
									"nextWeek.setDate(nextWeek.getDate() + 7);",
									"const startDate = nextWeek.toISOString().split('T')[0];",
									"pm.environment.set('partyDate', startDate + 'T00:00:00Z');",
									"pm.environment.set('partyStartTime', startDate + 'T18:00:00Z');",
									"pm.environment.set('partyEndTime', startDate + 'T22:00:00Z');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have app_code', () => { pm.expect(jsonData).to.have.property('app_code'); });",
									"pm.environment.set('partyAppointmentCode', jsonData.app_code);",
									"pm.test('Attendees booked should be 0', () => { pm.expect(jsonData.attendees_booked).to.eql(0); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken1}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"title\": \"Grand Opening Party\",\n    \"start_time\": \"{{partyStartTime}}\",\n    \"end_time\": \"{{partyEndTime}}\",\n    \"start_date\": \"{{partyDate}}\",\n    \"end_date\": \"{{partyDate}}T23:59:59Z\",\n    \"booking_duration\": 240,\n    \"type\": \"party\",\n    \"max_attendees\": 5,\n    \"description\": \"Join us for our grand opening!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							]
						}
					}
				},
				{
					"name": "Book Party (User 1, 3 attendees)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have booking_code', () => { pm.expect(jsonData).to.have.property('booking_code'); });",
									"pm.environment.set('partyBookingCode1', jsonData.booking_code);",
									"pm.test('Attendee count should be 3', () => { pm.expect(jsonData.attendee_count).to.eql(3); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken1}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"app_code\": \"{{partyAppointmentCode}}\",\n    \"start_time\": \"{{partyStartTime}}\",\n    \"end_time\": \"{{partyEndTime}}\",\n    \"date\": \"{{partyDate}}\",\n    \"attendee_count\": 3\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/book/registered",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"book",
								"registered"
							]
						}
					}
				},
				{
					"name": "Book Party (User 2, 2 attendees)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have booking_code', () => { pm.expect(jsonData).to.have.property('booking_code'); });",
									"pm.environment.set('partyBookingCode2', jsonData.booking_code);",
									"pm.test('Attendee count should be 2', () => { pm.expect(jsonData.attendee_count).to.eql(2); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken2}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"app_code\": \"{{partyAppointmentCode}}\",\n    \"start_time\": \"{{partyStartTime}}\",\n    \"end_time\": \"{{partyEndTime}}\",\n    \"date\": \"{{partyDate}}\",\n    \"attendee_count\": 2\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/book/registered",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"book",
								"registered"
							]
						}
					}
				},
				{
					"name": "Attempt to Overbook Party",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 Bad Request', () => { pm.response.to.have.status(400); });",
									"pm.test('Error message should indicate capacity issue', () => {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('message');",
									"    pm.expect(response.message.toLowerCase()).to.include('not enough capacity');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken1}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"app_code\": \"{{partyAppointmentCode}}\",\n    \"start_time\": \"{{partyStartTime}}\",\n    \"end_time\": \"{{partyEndTime}}\",\n    \"date\": \"{{partyDate}}\",\n    \"attendee_count\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/book/registered",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"book",
								"registered"
							]
						}
					}
				},
				{
					"name": "Cancel Party Booking (User 1)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 OK', () => { pm.response.to.have.status(200); });",
									"const jsonData = pm.response.json();",
									"pm.test('Response should have status', () => { pm.expect(jsonData).to.have.property('status'); });",
									"pm.test('Status should be cancelled', () => { pm.expect(jsonData.status).to.eql('cancelled'); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken1}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/bookings/{{partyBookingCode1}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"bookings",
								"{{partyBookingCode1}}"
							]
						}
					}
				},
				{
					"name": "Book Party Again (User 1, 3 attendees)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201 Created', () => { pm.response.to.have.status(201); });",
									"const jsonData = pm.response.json();",
									"pm.test('Booking should be successful', () => {",
									"    pm.expect(jsonData).to.have.property('booking_code');",
									"    pm.expect(jsonData.attendee_count).to.eql(3);",
									"    pm.environment.set('partyBookingCode1', jsonData.booking_code);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{authToken1}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"app_code\": \"{{partyAppointmentCode}}\",\n    \"start_time\": \"{{partyStartTime}}\",\n    \"end_time\": \"{{partyEndTime}}\",\n    \"date\": \"{{partyDate}}\",\n    \"attendee_count\": 3\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/book/registered",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"book",
								"registered"
							]
						}
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8888",
			"type": "string",
			"description": "Base URL for the API"
		}
	]
}
